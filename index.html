<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>incomzone</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background: #f9f9f9;
      transition: background-color 0.8s ease, color 0.8s ease;
    }
    #status {
      font-size: 1.5rem;
      text-align: center;
      color: #333;
    }
    #transition {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: white;
      display: none;
      justify-content: center;
      align-items: center;
      font-size: 1.8rem;
      color: #555;
      transition: opacity 1s ease;
      z-index: 9999;
    }
  </style>
  <script>
    const VM_URL = "http://incomzone.co.kr";
    const now = new Date();
    const hourKST = (now.getUTCHours() + 9) % 24;
    const minuteKST = now.getUTCMinutes();
    const currentTimeMinutes = hourKST * 60 + minuteKST; // 현재 시각(분 단위)

    async function isVMOnline() {
      try {
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 2000);
        await fetch(VM_URL, { method: "HEAD", mode: "no-cors", signal: controller.signal });
        clearTimeout(timeout);
        return true;
      } catch {
        return false;
      }
    }

    function showStatus(msg) {
      document.getElementById("status").innerText = msg;
    }

    function showTransition(msg) {
      const overlay = document.getElementById("transition");
      overlay.innerText = msg;
      overlay.style.display = "flex";
      overlay.style.opacity = "1";
    }

    async function main() {
      const vmAlive = await isVMOnline();

      // 07:30~08:00 사이: "곧 시작됩니다" 메시지 표시
      const startMinutes = 8 * 60; // 08:00
      const preStartMinutes = 7 * 60 + 30; // 07:30
      const isPreStartTime = (currentTimeMinutes >= preStartMinutes && currentTimeMinutes < startMinutes);

      if (hourKST >= 8 && hourKST < 20) {
        // 주간: VM이 우선
        if (vmAlive) {
          showTransition("서비스로 이동중입니다...");
          setTimeout(() => window.location.replace(VM_URL), 1500);
        } else {
          showStatus("현재 VM 이 준비 중입니다. 잠시 후 연결됩니다.");
          setTimeout(main, 60000); // 1분마다 재시도
        }
      } else if (isPreStartTime) {
        // VM 시작 30분 전 UX 메시지
        showStatus("잠시 후 서비스가 시작됩니다.");
        setTimeout(main, 60000); // 1분마다 재시도
      } else {
        // 야간: GitHub Pages 유지
        showStatus("현재는 정기 점검 시간입니다. 서비스는 오전 8시에 재개됩니다.");
      }
    }
    window.onload = main;
  </script>
</head>
<body>
  <div id="status">초기화 중...</div>
  <div id="transition"></div>
</body>
</html>
